---
title: definePlugin
description: Allows defining a type-safe plugin that can be used in defineIntegration.
---
import Disabled from "~/components/Disabled.astro"
import { LinkCard } from '@astrojs/starlight/components';

Allows defining a type-safe plugin that can be used in `defineIntegration`.

:::caution
This utility is for advanced use-cases. It's useful for developers that want to create
3rd party plugins for Astro Integration Kit, or if you want to learn a little bit more
about the internals.
:::

:::caution
This API will radically change in `0.9.x`.
:::

```ts title="package/plugins/add-vite-plugin.ts"
import { definePlugin } from "../core/define-plugin.js";
import { addVitePlugin } from "../utilities/add-vite-plugin.js";
import type { Plugin as VitePlugin } from "vite"

export const addVitePluginPlugin = definePlugin({
	name: "addVitePlugin",
	hook: "astro:config:setup",
	implementation:
		({ updateConfig }) =>
		(plugin: VitePlugin) =>
			addVitePlugin({ plugin, updateConfig }),
});
```

You can then use it in [`withPlugins`](/core/with-plugins/):

```ts title="my-integration/index.ts" "withPlugins" "addVitePluginPlugin"
import { defineIntegration, withPlugins } from "astro-integration-kit";
import { addVitePluginPlugin } from "../package/plugins/add-vite-plugin.js";

export default defineIntegration({
    name: "my-integration",
    setup({ name }) {
        return withPlugins({
            name,
            plugins: [addVitePluginPlugin],
            hooks: {
                "astro:config:setup": ({ addVitePlugin }) => {}
            }
        })
    }
})
```


## Limitations

1. Plugins support overrides. That means that if 2 plugins declare the same `name`, the latest will be kept.

## Practical examples

Astro Integration Kit uses `definePlugin` for its core plugins under the hood,
have a look at our source for practical examples!
