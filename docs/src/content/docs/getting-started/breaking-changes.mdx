---
title: Breaking changes
description: Features get added and removed, and breaking changes are introduced! This documents how to migrate.
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

Features get added and removed, and breaking changes are introduced! This documents how to migrate.

## `0.9.0`

---

### New `withPlugins` utility, `plugins` removed from `defineIntegration`

Plugins are no longer passed to `defineIntegration`. Instead, there's a new `withPlugins` utility.

```ts title="my-integration/index.ts" del={9,11-13} ins={3,14-20}
import {
    defineIntegration,
    withPlugins
} from "astro-integration-kit";
import { hasVitePluginPlugin } from "astro-integration-kit/plugins";

export default defineIntegration({
    name: "my-integration",
    plugins: [hasVitePluginPlugin],
    setup({ name }) {
        return {
            "astro:config:setup": ({ hasVitePlugin }) => {}
        }
        return withPlugins({
            name,
            plugins: [hasVitePluginPlugin],
            hooks: {
                "astro:config:setup": ({ hasVitePlugin }) => {}
            }
        })
    }
})
```

## `0.8.0`

---

### Removed plugins

The following plugins have been removed in favor of their standalone utility version:

- `addDevToolbarFrameworkAppPlugin`
- `addDtsPlugin`
- `addIntegrationPlugin`
- `addVirtualImportsPlugin`
- `addVitePluginPlugin`
- `hasIntegrationPlugin`
- `injectDevRoutePlugin`
- `watchIntegrationPlugin`

Only `hasVitePluginPlugin` remains.

### `corePlugins` removed

`corePlugins` is no longer exported from `astro-integration-kit`. Import the plugin you want directly:

```ts del={3,9} ins={4,10}
import { defineIntegration } from "astro-integration-kit"
import {
    corePlugins,
    hasVitePluginPlugin
} from "astro-integration-kit/plugins"

export default defineIntegration({
    // ...
    plugins: [...corePlugins],
    plugins: [hasVitePluginPlugin]
})
```

### Updated utilities

#### `addDevToolbarFrameworkApp`

```ts del={3-18} ins={19-30}
const { resolve } = createResolver(import.meta.url)

addDevToolbarFrameworkApp({
    framework: "vue",
    name: "Test Vue Plugin",
    id: "my-vue-plugin",
    icon: `<svg version="1.1" viewBox="0 0 261.76 226.69" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(1.3333 0 0 -1.3333 -76.311 313.34)"><g transform="translate(178.06 235.01)"><path d="m0 0-22.669-39.264-22.669 39.264h-75.491l98.16-170.02 98.16 170.02z" fill="#41b883"/></g><g transform="translate(178.06 235.01)"><path d="m0 0-22.669-39.264-22.669 39.264h-36.227l58.896-102.01 58.896 102.01z" fill="#34495e"/></g></g></svg>`,
    src: resolve("./my-plugin.vue"),
    style: `
        h1 {
            font-family: Inter;
        }
    `,
    config,
    updateConfig,
    addDevToolbarApp,
    injectScript,
})
addDevToolbarFrameworkApp(params, {
    framework: "vue",
    name: "Test Vue Plugin",
    id: "my-vue-plugin",
    icon: `<svg version="1.1" viewBox="0 0 261.76 226.69" xmlns="http://www.w3.org/2000/svg"><g transform="matrix(1.3333 0 0 -1.3333 -76.311 313.34)"><g transform="translate(178.06 235.01)"><path d="m0 0-22.669-39.264-22.669 39.264h-75.491l98.16-170.02 98.16 170.02z" fill="#41b883"/></g><g transform="translate(178.06 235.01)"><path d="m0 0-22.669-39.264-22.669 39.264h-36.227l58.896-102.01 58.896 102.01z" fill="#34495e"/></g></g></svg>`,
    src: resolve("./my-plugin.vue"),
    style: `
        h1 {
            font-family: Inter;
        }
    `,
})
```

#### `addDts`

```ts del={1-7} ins={8-11}
addDts({
    name: "my-integration",
    content: `declare module "virtual:my-integration" {}`,
    root: config.root,
    srcDir: config.srcDir,
    logger,
})
addDts(params, {
    name: "my-integration",
    content: `declare module "virtual:my-integration" {}`,
})
```

#### `addIntegration`

```ts del={1-6} ins={7-9}
addIntegration({
    integration: Vue(),
    updateConfig,
    config,
    logger,
})
addIntegration(params,{
    integration: Vue(),
})
```

#### `addVirtualImports`

```ts del={1-8} ins={9-14}
addVirtualImports({
    name: 'my-integration',
    imports: {
        'virtual:my-integration/config': `export default ${JSON.stringify({ foo: "bar" })}`,
    },
    updateConfig,
    config,
})
addVirtualImports(params, {
    name: 'my-integration',
    imports: {
        'virtual:my-integration/config': `export default ${JSON.stringify({ foo: "bar" })}`,
    },
})
```

#### `addVitePlugin`

```ts del={1-6} ins={7-9}
addVitePlugin({
    plugin: VitePWA({ registerType: 'autoUpdate' }),
    config,
    logger,
    updateConfig
})
addVitePlugin(params, {
    plugin: VitePWA({ registerType: 'autoUpdate' }),
})
```

#### `hasVitePlugin`

```ts del={1-4} ins={5-7}
hasVitePlugin({
    plugin: "vite-plugin-my-integration",
    config,
})
hasVitePlugin(params, {
    plugin: "vite-plugin-my-integration",
})
```

#### `hasIntegration`

```ts del={1-6} ins={7-11}
hasIntegration({
    name: "@astrojs/tailwind",
    position: "before",
    relativeTo: "my-integration",
    config,
})
hasIntegration(params, {
    name: "@astrojs/tailwind",
    position: "before",
    relativeTo: "my-integration",
})
```

#### `injectDevRoute`

```ts del={3-10} ins={11-14}
const { resolve } = createResolver(import.meta.url)

injectDevRoute({
    command,
    injectRoute,
    injectedRoute: {
        pattern: "/foo",
        entrypoint: resolve("./pages/foo.astro")
    },
})
injectDevRoute(params, {
    pattern: "/foo",
    entrypoint: resolve("./pages/foo.astro")
})
```

#### `watchIntegration`

```ts del={3-8} ins={9}
const { resolve } = createResolver(import.meta.url)

watchIntegration({
    addWatchFile,
    command,
    dir: resolve(),
    updateConfig,
});
watchIntegration(params, resolve())
```

## `0.7.0`

---

### Updated `options` and `optionsSchema`

They're not optional by default, you need to manually add `.optional()` at the end of your zod schema.
If it's optional, users can still pass nothing or `undefined`.

```ts del={3} ins={4}
defineIntegration({
    // ...
    optionsSchema: z.object({ foo: z.string() }),
    optionsSchema: z.object({ foo: z.string() }).optional(),
})
```

### Plugins types

Plugin generics have been simplified, allowing simpler plugin builds. This should be non-breaking for plugin
relying on type inference, plugins with explicitly declared signature should update the following:

```ts del={4} ins={5}
type SomePlugin = Plugin<
    "utilityName",
    "astro:config:setup",
    (p: HookParams) => (params: UtilityParams) => UtilityOutput
    (params: UtilityParams) => UtilityOutput
>;

export const somePlugin: SomePlugin = definePlugin();
```

## `0.6.0`

---

### Updated `addVitePlugin`

The `addVitePlugin` utility now requires a `config` and `logger` parameter to log warnings for duplicate plugins

```ts ins={4,5}
"astro:config:setup": ({ config, updateConfig }) => {
    addVitePlugin({
        plugin,
        config,
        logger
        updateConfig
    })
}
```

Or you can turn off warnings for duplicate plugins using `warnDuplicate: false`

```ts ins={2}
addVitePlugin({
    warnDuplicate: false,
    plugin,
    updateConfig
})
```

### Updated `addVirtualImports`

The `addVirtualImports` utility now requires a `config` parameter

```ts ins={1,4}
"astro:config:setup": ({ config, updateConfig }) => {
    addVirtualImports({
        updateConfig,
        config
        name: 'my-integration',
        imports: {
            'virtual:my-integration/config': `export default ${JSON.stringify({ foo: "bar" })}`,
        },
    })
}
```

### Updated `addDevToolbarFrameworkApp`

The `addDevToolbarFrameworkApp` utility now requires a `config` parameter

```ts ins={1,3}
"astro:config:setup": ({ config, updateConfig }) => {
    addDevToolbarFrameworkApp({
        config,
        framework: "vue",
        name: "Test Vue Plugin",
        id: "my-vue-plugin",
        icon: `<svg>...</svg>`,
        src: resolve("./my-plugin.vue"),
        style: `
            h1 {
                font-family: Inter;
            }
        `,
    })
}
```

## `0.5.0`

---

### Updated `addVirtualImport`

`addVirtualImport` was removed in `0.5.0`. Here is how to migrate:

<Tabs>
    <TabItem label="Extended hooks">
    ```ts title="my-integration/index.ts" del={2,7,11,13-20} ins={3,8,12,21-24}
    import { defineIntegration } from "astro-integration-kit";
    import { addVirtualImportPlugin } from "astro-integration-kit/plugins";
    import { addVirtualImportsPlugin } from "astro-integration-kit/plugins";

    export default defineIntegration({
        name: "my-integration",
        plugins: [addVirtualImportPlugin],
        plugins: [addVirtualImportsPlugin],
        setup() {
            return {
                "astro:config:setup": ({ addVirtualImport }) => {
                "astro:config:setup": ({ addVirtualImports }) => {
                    addVirtualImport({
                        name: 'virtual:my-integration/config',
                        content: `export default ${JSON.stringify({ foo: "bar" })}`,
                    })
                    addVirtualImport({
                        name: 'virtual:my-integration/context',
                        content: `export default ${JSON.stringify({ entrypoint: import.meta.url })}`,
                    })
                    addVirtualImports({
                        'virtual:my-integration/config': `export default ${JSON.stringify({ foo: "bar" })}`,
                        'virtual:my-integration/context': `export default ${JSON.stringify({ entrypoint: import.meta.url })}`
                    })
                }
            }
        }
    })
    ```
    </TabItem>
    <TabItem label="Standalone utilities">
    ```ts title="integration/index.ts" del={2,10-21} ins={3,22-30}
    import type { AstroIntegration } from "astro";
    import { addVirtualImport } from "astro-integration-kit/utilities";
    import { addVirtualImports } from "astro-integration-kit/utilities";

    export default function myIntegration(): AstroIntegration {
        return {
            name: "my-integration",
            hooks: {
                "astro:config:setup": ({ config, updateConfig }) => {
                    addVirtualImport({
                        updateConfig,
                        config,
                        name: 'virtual:my-integration/config',
                        content: `export default ${JSON.stringify({ foo: "bar" })}`,
                    })
                    addVirtualImport({
                        updateConfig,
                        config,
                        name: 'virtual:my-integration/context',
                        content: `export default ${JSON.stringify({ entrypoint: import.meta.url })}`,
                    })
                    addVirtualImports({
                        updateConfig,
                        config,
                        name: 'my-integration',
                        imports: {
                            'virtual:my-integration/config': `export default ${JSON.stringify({ foo: "bar" })}`,
                            'virtual:my-integration/context': `export default ${JSON.stringify({ entrypoint: import.meta.url })}`
                        },
                    })
                }
            }
        }
    }
    ```
    </TabItem>
</Tabs>


## `0.2.0`

---

### Removed `defineOptions`

`defineOptions` has been removed in `0.2.0`. Here is how to migrate:

```ts title="my-integration/index.ts" del={1,5-12,16} ins={2-3,17-24}
import { defineIntegration, defineOptions } from "astro-integration-kit";
import { defineIntegration } from "astro-integration-kit";
import { z } from "astro/zod";

type Options = {
    /**
     * A comment
     *
     * @default `"bar"`
     */
    foo?: string | undefined;
}

export default defineIntegration({
    // ...
    options: defineOptions<Options>({ foo: "bar" }),
    optionsSchema: z.object({
        /**
         * A comment
         *
         * @default `"bar"`
         */
        foo: z.string().optional().default("bar"),
    }),
})
```
